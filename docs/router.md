# 后端路由设计

这里路由设计分为三部分，一个是用户相关路由，一个是游记列表相关路由，一个是游记详情相关路由。

## 用户相关路由

### 注册

`post /users/register`

请求体（JSON 格式）：

- `username` 用户名
- `password` 密码
- `nickname` 昵称

返回状态码和数据：

- `201` 注册成功
- `400` 附带可能的用户错误输入信息（比如已存在用户）
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 登录

`post /users/login`

请求体（JSON 格式）：

- `username` 用户名
- `password` 密码

返回状态码和数据：

- `200` 登录成功，返回 jwt token
- `400` 附带可能的用户错误输入信息（比如用户名或密码错误）
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 获取用户信息

`get /users/:username`

请求参数（URL 参数）：

- `username` 用户名

返回状态码和数据：

- `200` 获取成功，返回用户信息（不包括密码）
- `404` 用户不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 修改用户信息

`put /users/:username`

请求体（JSON 格式）：

- `username` 用户名
- `password` 密码
- `nickname` 昵称
- `jwt` token，注意这里坑能需要很多中间件的逻辑，（比如刷新 token，验证 token 等，还有判别是否是用户本人发送的更改本人的信息，防止他人发送恶意请求）

返回状态码和数据：

- `200` 修改成功
- `400` 附带可能的用户错误输入信息（比如密码错误）
- `401` 未授权，需要登录，即更新 token
- `403` 无权修改他人信息
- `404` 要修改的用户不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 删除用户

`delete /users/:username`

请求参数（URL 参数）：

- `username` 用户名

请求头：

- `jwt` token

返回状态码和数据：

- `200` 删除成功
- `401` 未授权，需要登录，即更新 token
- `403` 无权删除他人信息
- `404` 要删除的用户不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 上传用户头像

`post /users/avatar`

请求体（form-data 格式）：

- `avatar` 头像文件，注意这里需要使用 `multipart/form-data` 格式，解析方式可再商议

请求头：

- `jwt` token

返回状态码和数据：

- `200` 上传成功，返回头像 URL
- `400` 附带可能的用户错误输入信息（比如文件格式错误）
- `401` 未授权，需要登录，即更新 token
- `404` 用户不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 获取用户头像

`get /users/avatar/:username`

请求参数（URL 格式）

- `username` 用户名

返回状态码和数据：

- `200` 获取成功，返回头像 URL
- `404` 用户不存在，或者用户没有头像，前端考虑使用默认头像
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 校验登录状态（unstable）

`get /users/check`

请求头：

- `jwt` token

返回状态码和数据：

- `200` 登录状态有效
- `401` 未授权，需要登录，即更新 token
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

::: tip
是否考虑将前端发送请求的内容统一格式，比如必定传送 username 和 jwt，这样可以减少一些逻辑判断，但是会增加一些数据传输量。
:::

## 游记列表路由

### 请求游记列表

`get /travels`

请求参数（URL 格式）：

- `page` 页码
- `limit` 每页数量

返回状态码和数据：

- `200` 获取成功，返回游记列表（不包括内容）
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）
- `404` 获取页面不存在（游记列表为空）

### 请求用户游记列表

`get /travels/:username`

请求参数（URL 格式）：

- `username` 用户名

返回状态码和数据：

- `200` 获取成功，返回用户的游记列表（不包括内容）
- `404` 用户不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

## 游记详情路由

### 请求游记详情

`get /travel/:id`

请求参数：

- `id` 游记的唯一标识

返回状态码和数据：

- `200` 获取成功，返回游记详情（包括内容）
- `404` 游记不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 发布游记（unstable）

`post /travel`

请求体（JSON 格式）

- `title` 游记标题
- `content` 游记内容
- `cover` 游记封面图片
- `jwt` token

返回状态码和数据：

- `200` 发布成功，返回游记的唯一标识
- `400` 附带可能的用户错误输入信息（比如标题为空）
- `401` 未授权，需要登录，即更新 token
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 上传游记封面

`post /travel/cover`

请求体（form-data 格式）：

- `cover` 封面图片文件

请求头：

- `jwt` token

返回状态码和数据：

- `200` 上传成功，返回封面 URL

### 获取游记封面

`get /travel/cover/:id`

请求参数（URL 格式）：

- `id` 游记的唯一标识

返回状态码和数据：

- `200` 获取成功，返回封面的图片（使用 `file` 类型返回）
- `404` 游记不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 修改游记（unstable）

`put /travel/:id`

这里似乎也可以使用 `patch` 方法，因为如果我们只修改了游记的标题，那么只需要传递标题即可，不需要传递所有的内容。附带正文会导致传输量增加，但是也可以减少一些逻辑判断。

请求体（JSON 格式）：

- `id` 游记的唯一标识
- `title` 游记标题
- `content` 游记内容
- `cover` 游记封面图片
- `jwt` token

返回状态码和数据：

- `200` 修改成功
- `400` 附带可能的用户错误输入信息（比如标题为空）
- `401` 未授权，需要登录，即更新 token
- `403` 无权修改他人游记
- `404` 游记不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 删除游记

`delete /travel/:id`

注意这里的删除是逻辑删除，即将游记的 `delete` 字段设置为 `1`。

请求体（JSON 格式）：

- `id` 游记的唯一标识

请求头：

- `jwt` token

返回状态码和数据：

- `200` 删除成功
- `401` 未授权，需要登录，即更新 token
- `403` 无权删除他人游记
- `404` 游记不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）

### 游记审核

游记审核只能是管理员（3）和审核人员（2）进行，这里不做详细设计，只是简单的设计一个接口。

`put /travel/review`

请求体（JSON 格式）：

- `id` 游记的唯一标识
- `review` 审核状态，0 为未审核，1 为审核通过，2 为审核未通过
- `msg` 审核附带信息

请求头：

- `jwt` token

返回状态码和数据：

- `200` 审核成功
- `400` 附带可能的用户错误输入信息（比如审核状态错误）
- `401` 未授权，需要登录，即更新 token
- `403` 无权审核游记
- `404` 游记不存在
- `500` 服务器错误（比如数据库错误，非用户问题，需要展示相关信息）
